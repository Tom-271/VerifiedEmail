<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>INGEFIT • Email verificata</title>
  <style>
    :root{
      --bg:#0b0d12; --txt:#e6e6e6; --muted:#9aa0a6;
      --p200:#BB86FC;        /* viola titolo/linea/tagline */
      --card:#12141a; --card-border:rgba(187,134,252,.25);
      --chip:#1b1f2a;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--txt);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      padding:32px 24px 64px}
    .wrap{max-width:1100px;margin:0 auto}

    /* HEADER: titolo sopra, sotto riga corta + tagline a destra */
    .hero{
      display:grid;
      grid-template-columns: clamp(140px,45%,320px) 1fr; /* col 1: riga; col 2: testo a destra */
      grid-template-rows: auto auto;                    /* riga 1: titolo; riga 2: riga + tagline */
      column-gap:18px;
      row-gap:6px;
      align-items:end;
      margin-bottom:28px;
    }
    .brand{
      grid-column:1 / span 2; grid-row:1;
      color:var(--p200);font-weight:900;letter-spacing:.06em;
      text-transform:uppercase;line-height:.95;font-size:clamp(40px,9vw,104px)
    }
    .line{
      grid-column:1; grid-row:2;
      height:6px;background:var(--p200);border-radius:4px; width:100%;
      justify-self:start;
    }
    .tagline{
      grid-column:2; grid-row:2; align-self:end; justify-self:start;
      color:var(--p200); font-weight:800; text-transform:uppercase;
      letter-spacing:.02em; white-space:nowrap; font-size:clamp(14px,2.2vw,20px);
    }

    /* pannello successo */
    .panel{background:var(--card);border:1px solid var(--card-border);
      border-radius:16px;padding:28px 26px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .title{font-size:28px;font-weight:900;margin:0 0 10px}
    .lead{color:var(--muted);margin:0 0 18px;line-height:1.7}
    .bullets{margin:6px 0 0 0;padding:0 0 0 18px}
    .bullets li{margin:8px 0;line-height:1.7}

    /* PRO CARDS (stile “badge”) */
    .proGrid{margin-top:22px;display:grid;gap:18px;
      grid-template-columns:repeat(auto-fit,minmax(270px,1fr))}
    .proCard{position:relative;background:var(--card);border-radius:18px;
      border:2px solid rgba(187,134,252,.35);box-shadow:0 8px 28px rgba(0,0,0,.25);
      padding:22px;text-align:center;overflow:hidden}
    .proCard::after{content:"";position:absolute;inset:0;border-radius:18px;
      box-shadow:0 0 0 6px rgba(187,134,252,.08) inset;pointer-events:none}
    .avatar{width:72px;height:72px;border-radius:50%;margin:0 auto 10px;
      display:grid;place-items:center;background:rgba(187,134,252,.12);color:var(--p200)}
    .name{margin:6px 0 2px;font-weight:800;font-size:20px}
    .role{margin:0;color:#cfcfe6;font-size:14px}
    .sep{height:2px;background:rgba(187,134,252,.25);margin:14px auto 10px;width:70%}
    .desc{margin:0;color:var(--muted);line-height:1.7;font-size:14px}
    .social{display:flex;gap:12px;justify-content:center;margin-top:14px}
    .social a{display:inline-grid;place-items:center;width:34px;height:34px;border-radius:8px;
      background:var(--chip);color:var(--p200);text-decoration:none;border:1px solid rgba(187,134,252,.25)}
    .social a:hover{filter:brightness(1.08)}
    footer{margin-top:18px;color:var(--muted);font-size:12px;text-align:center}
  </style>
</head>
<body>
  <div class="wrap">
    <header class="hero">
      <div class="brand">INGEFIT</div>
      <div class="line"></div>
      <div class="tagline">PRONTO AD ALLENARTI?</div>
    </header>

    <section class="panel">
      <h1 class="title">Email verificata con successo ✅</h1>
      <p class="lead">
        Il tuo account è stato verificato e la tua mail è attiva. Da questo momento hai accesso completo all’ecosistema INGEFIT.
      </p>
      <ul class="bullets">
        <li><strong>Siamo lieti di averti con noi!</strong> Il tuo profilo è pronto per partire.</li>
        <li><strong>Sicurezza prima di tutto:</strong> la verifica serve a controllare che sia proprio tu il proprietario della mail.</li>
        <li><strong>Adesso si fa sul serio:</strong> imposta i tuoi obiettivi, crea i piani di allenamento e inizia ad allenarti.</li>
      </ul>

      <!-- SOLO DUE CARDS: PT e NUTRIZIONISTA -->
      <div class="proGrid" aria-label="Professionisti a tua disposizione">
        <!-- PT -->
        <article class="proCard">
          <div class="avatar" aria-hidden="true">
            <!-- silhouette manubrio -->
            <svg width="34" height="34" viewBox="0 0 24 24" fill="currentColor">
              <rect x="3" y="9" width="2" height="6" rx="1"></rect>
              <rect x="6" y="8" width="2" height="8" rx="1"></rect>
              <rect x="10" y="11" width="4" height="2" rx="1"></rect>
              <rect x="16" y="8" width="2" height="8" rx="1"></rect>
              <rect x="19" y="9" width="2" height="6" rx="1"></rect>
            </svg>
          </div>
          <h3 class="name">Personal Trainer</h3>
          <p class="role">Programmazione • Tecnica • Motivazione</p>
          <div class="sep"></div>
          <p class="desc">
            Allenamenti su misura e progressioni efficaci, con attenzione alla tecnica e alla costanza.
            Professionisti certificati pronti ad affiancarti 1:1.
          </p>
          <div class="social" aria-label="Contatti"></div>
        </article>

        <!-- NUTRIZIONISTA -->
        <article class="proCard">
          <div class="avatar" aria-hidden="true">
            <!-- silhouette mela -->
            <svg width="34" height="34" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 7c2.2-1.6 2.4-4 1-5 0 0 2.5-.2 3.8 1.6 1.2 1.7.6 3.7-.8 4.9 2.5 1 4 3.4 4 6.1 0 4.1-3.3 7.4-7.4 7.4S5.2 18.7 5.2 14.6c0-2.7 1.6-5.1 4.1-6.1C9.9 8.1 10.9 8.4 12 9c1.1-.6 2.1-.9 2.7-1.5-.9-.1-1.9-.3-2.7-.5z"></path>
              <path d="M8.8 4.3c1.1 1.1 3 .9 3 .9s-.2-1.9-.9-2.9C10 1.2 8.7.8 7.7 1.5 6.7 2.2 7.7 3.2 8.8 4.3z"></path>
            </svg>
          </div>
          <h3 class="name">Nutrizionista</h3>
          <p class="role">Educazione alimentare • Piani su misura</p>
          <div class="sep"></div>
          <p class="desc">
            Strategie nutrizionali personalizzate per performance, benessere e ricomposizione.
            Monitoraggio periodico e aggiustamenti chiari.
          </p>
        </article>
      </div>
    </section>

    <footer>Il tuo team è sempre a disposizione! © INGEFIT</footer>
  </div>

<script type="module">
  import {
    initializeApp
  } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
  import {
    getAuth,
    checkActionCode,
    applyActionCode,
    verifyPasswordResetCode,
    confirmPasswordReset
  } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";

  // ⚠️ stessa config del progetto Android
  const firebaseConfig = {
    apiKey: "AIzaSyD44-_QQ63SD-JVBGm2AwtPCl1ahHD2FrQ",
    authDomain: "esame-9aa37.firebaseapp.com",
    projectId: "esame-9aa37",
    storageBucket: "esame-9aa37.firebasestorage.app",
    messagingSenderId: "1041503427752",
    appId: "1:1041503427752:web:337b2e422ba5f895a2f69d"
  };

  const app  = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  auth.languageCode = 'it';

  const qs = new URLSearchParams(location.search);
  const mode = qs.get('mode');
  const code = qs.get('oobCode');
  const continueUrl = qs.get('continueUrl') ? decodeURIComponent(qs.get('continueUrl')) : null;

  const panel = document.querySelector('.panel');

  function setTitle(t){ document.title = `INGEFIT • ${t}`; }
  function setTagline(t){ const tg = document.querySelector('.tagline'); if(tg) tg.textContent = t; }

  function renderVerifySuccess(){
    setTitle('Email verificata');
    setTagline('PRONTO AD ALLENARTI?');
    // aggiunge banner di stato in fondo alla card
    const banner = document.createElement('div');
    banner.style.cssText = "margin-top:12px;color:#9aa0a6;font-size:13px";
    banner.textContent = "✔ Email verificata. Puoi tornare all’app.";
    panel.appendChild(banner);
    if(continueUrl){
      const a = document.createElement('a');
      a.href = continueUrl;
      a.textContent = "Torna all’app";
      a.style.cssText = "display:inline-block;margin-top:12px;padding:10px 14px;border-radius:10px;border:1px solid rgba(187,134,252,.35);background:#1b1f2a;color:#BB86FC;text-decoration:none;font-weight:800";
      panel.appendChild(a);
    }
  }

  function renderRecoverSuccess(oldEmail, newEmail){
    setTitle('Email ripristinata');
    setTagline('ACCOUNT RECUPERATO');
    panel.innerHTML = `
      <h1 class="title">Email ripristinata ✅</h1>
      <p class="lead">Il tuo indirizzo è stato riportato da <strong>${newEmail || ''}</strong> a <strong>${oldEmail || ''}</strong>.</p>
    `;
    if(continueUrl){
      panel.insertAdjacentHTML('beforeend',
        `<a href="${continueUrl}" style="display:inline-block;margin-top:12px;padding:10px 14px;border-radius:10px;border:1px solid rgba(187,134,252,.35);background:#1b1f2a;color:#BB86FC;text-decoration:none;font-weight:800">Torna all’app</a>`);
    }
  }

  function renderResetForm(email){
    setTitle('Reimposta password');
    setTagline('SICUREZZA ACCOUNT');

    panel.innerHTML = `
      <h1 class="title">Reimposta la password</h1>
      <p class="lead">Stai reimpostando la password per <strong>${email || ''}</strong>.</p>

      <div class="formRow" style="margin-top:10px">
        <label for="newPass" style="display:block;margin:8px 0 6px">Nuova password</label>
        <input id="newPass" type="password" autocomplete="new-password"
               style="width:100%;padding:12px;border-radius:10px;border:1px solid rgba(187,134,252,.25);background:#0b0d12;color:#e6e6e6">
      </div>

      <div class="formRow" style="margin-top:10px">
        <label for="newPass2" style="display:block;margin:8px 0 6px">Conferma password</label>
        <input id="newPass2" type="password" autocomplete="new-password"
               style="width:100%;padding:12px;border-radius:10px;border:1px solid rgba(187,134,252,.25);background:#0b0d12;color:#e6e6e6">
      </div>

      <button id="btnConfirm" style="margin-top:14px;padding:12px 16px;border-radius:12px;border:1px solid rgba(187,134,252,.35);background:#1b1f2a;color:#BB86FC;font-weight:900;cursor:pointer">
        Imposta password
      </button>

      <div id="resetMsg" style="margin-top:12px;color:#9aa0a6;font-size:13px"></div>
    `;

    const btn = document.getElementById('btnConfirm');
    const msg = document.getElementById('resetMsg');

    btn.addEventListener('click', async () => {
      const p1 = /** @type {HTMLInputElement} */(document.getElementById('newPass')).value.trim();
      const p2 = /** @type {HTMLInputElement} */(document.getElementById('newPass2')).value.trim();

      // controlli base
      if(!p1 || !p2){ msg.textContent = "Inserisci e conferma la nuova password."; return; }
      if(p1 !== p2){ msg.textContent = "Le password non coincidono."; return; }
      if(p1.length < 6){ msg.textContent = "La password deve avere almeno 6 caratteri."; return; }

      btn.disabled = true; msg.textContent = "Salvataggio in corso…";

      try{
        await confirmPasswordReset(auth, code, p1);
        msg.textContent = "✔ Password aggiornata. Ora puoi accedere con le nuove credenziali.";
        if(continueUrl){
          const a = document.createElement('a');
          a.href = continueUrl;
          a.textContent = "Torna all’app";
          a.style.cssText = "display:inline-block;margin-top:10px;padding:10px 14px;border-radius:10px;border:1px solid rgba(187,134,252,.35);background:#1b1f2a;color:#BB86FC;text-decoration:none;font-weight:800";
          panel.appendChild(a);
        }
      }catch(e){
        console.error(e);
        btn.disabled = false;
        msg.textContent = "⚠ Impossibile aggiornare la password: " + (e?.message || e);
      }
    });
  }

  async function run(){
    try{
      if(!mode || !code){
        setTitle('Link non valido');
        document.querySelector('.tagline')?.remove();
        panel.innerHTML = `
          <h1 class="title">Link non valido ❌</h1>
          <p class="lead">Apri questa pagina dal link ricevuto via email.</p>
        `;
        return;
      }

      // smista per modalità
      if(mode === 'verifyEmail'){
        await checkActionCode(auth, code);     // debug/validità
        await applyActionCode(auth, code);     // applica verifica
        renderVerifySuccess();
        return;
      }

      if(mode === 'resetPassword'){
        // verifica subito il codice e ricava la mail
        const email = await verifyPasswordResetCode(auth, code);
        renderResetForm(email);
        return;
      }

      if(mode === 'recoverEmail'){
        // checkActionCode → contiene dati con email(s)
        const info = await checkActionCode(auth, code);
        await applyActionCode(auth, code);
        const restored = info?.data?.email;     // email ripristinata
        const prev = info?.data?.previousEmail; // se disponibile
        renderRecoverSuccess(restored, prev);
        return;
      }

      // fallback
      setTitle('Operazione non supportata');
      panel.innerHTML = `
        <h1 class="title">Operazione non supportata</h1>
        <p class="lead">Modalità sconosciuta: <code>${mode}</code>.</p>
      `;
    }catch(e){
      console.error(e);
      setTitle('Errore');
      panel.innerHTML = `
        <h1 class="title">Si è verificato un errore</h1>
        <p class="lead">Dettagli: ${(e && e.message) || e}</p>
        <p class="lead">Richiedi un nuovo link e riprova.</p>
      `;
    }
  }

  run();
</script>


</body>
</html>
